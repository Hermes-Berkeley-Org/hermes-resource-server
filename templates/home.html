{% extends 'header.html' %}
{% block title %}Hermes | Dashboard{% endblock %}
{% block head %}{{ super() }}{% endblock %}
{% block content %}

<div class="wrapper text-primary full-section-shifted">
    <h2>Welcome, {{user['name']}}</h2>
    <br />
    <h3>Classes</h3>
    <h4>{{curr_semester}}</h4>
    {% if classes|exclude([('role', 'student')])|selectattr('semester', curr_semester) %}
        <h5>Staff Classes</h5>
    {% endif %}
=    <div>
    {% set counter = [0] %}
    {% for class in classes %}
        {% if class['role'] != 'student' and class['semester'] == curr_semester %}
            {% if class['class_exists'] %}
                {% if counter == [0] %}
                    <div class="row"> <!-- Start row -->
                {% endif %}
                <div class="col-md-4 class-box"><a href="{{ url_for('classpage', class_ok_id=class['ok_id']) }}">{{class['display_name']}} ({{class['role'].capitalize()}})</a></div>
                {% if counter.append(counter.pop() + 1) %}{% endif %}
                {% if counter == [3] %} 
                    </div> <!-- End row -->
                    {% if counter.pop() %}{% endif %}
                    {% if counter.append(0) %}{% endif %}
                {% endif %}
            {% else %}
                {% if counter == [0] %}
                    <div class="row"> <!-- Start row -->
                {% endif %}
                <div class="col-md-4 class-box"><a href="{{ url_for('create_class', class_ok_id=class['ok_id']) }}">{{class['display_name']}} ({{class['role'].capitalize()}})</a></div>
                {% if counter.append(counter.pop() + 1) %}{% endif %}
                {% if counter == [3] %} 
                    </div> <!-- End row -->
                    {% if counter.pop() %}{% endif %}
                    {% if counter.append(0) %}{% endif %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}
    {% if counter != [0] %}
        </div> <!-- No more classes, but finish row -->
    {% endif %}
    </div>
    {% if classes|selectattr('role', 'student') and classes|selectattr('semester', curr_semester) %}
        <h5>Student Classes</h5>
    {% endif %}
    <div>
    {% set counter = [0] %}
    {% for class in classes %}
        {% if class['role'] == 'student' and class['semester'] == curr_semester %}
            {% if counter == [0] %}
                <div class="row"> <!-- Start row -->
            {% endif %}
            <div class="col-md-4 class-box"><a href="{{ url_for('classpage', class_ok_id=class['ok_id']) }}">{{class['display_name']}}</a></div>
            {% if counter.append(counter.pop() + 1) %}{% endif %}
            {% if counter == [3] %} 
                </div> <!-- End row -->
                {% if counter.pop() %}{% endif %}
                {% if counter.append(0) %}{% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}
    {% if counter != [0] %}
        </div> <!-- No more classes, but finish row -->
    {% endif %}
    </div>
    <br><br>
    <h4>Previous Classes</h4>
    {% if classes|exclude([('role', 'student'), ('semester', curr_semester)]) %}
        <h5>Staff Classes</h5>
    {% endif %}
    <div>
    {% set counter = [0] %}
    {% for class in classes %}
        {% if class['role'] != 'student' and class['semester'] != curr_semester %}
            {% if class['class_exists'] %}
                {% if counter == [0] %}
                    <div class="row"> <!-- Start row -->
                {% endif %}
                <div class="col-md-4 class-box"><a href="{{ url_for('classpage', class_ok_id=class['ok_id']) }}">{{class['display_name']}} ({{class['semester']}}) ({{class['role'].capitalize()}})</a></div>
                {% if counter.append(counter.pop() + 1) %}{% endif %}
                {% if counter == [3] %} 
                    </div> <!-- End row -->
                {% endif %}
            {% else %}
                {% if counter == [0] %}
                    <div class="row"> <!-- Start row -->
                {% endif %}
                <div class="col-md-4 class-box"><a href="{{ url_for('create_class', class_ok_id=class['ok_id']) }}">{{class['display_name']}} ({{class['semester']}}) ({{class['role'].capitalize()}})</a></div>
                {% if counter.append(counter.pop() + 1) %}{% endif %}
                {% if counter == [3] %} 
                    </div> <!-- End row -->
                {% endif %}
            {% endif %}
        {% endif %}
    {% endfor %}
    {% if counter != [0] %}
        </div> <!-- No more classes, but finish row -->
    {% endif %}
    </div>
    {% if classes|exclude([('semester', curr_semester)])|selectattr('role', 'student') %}
        <h5>Student Classes</h5>
    {% endif %}
    <div>
    {% set counter = [0] %}
    {% for class in classes %}
        {% if class['role'] == 'student' and class['semester'] != curr_semester %}
            {% if counter == [0] %}
                <div class="row"> <!-- Start row -->
            {% endif %}
            <div class="col-md-4 class-box"><a href="{{ url_for('classpage', class_ok_id=class['ok_id']) }}">{{class['display_name']}} ({{class['semester']}}) ({{class['role'].capitalize()}}) </a></div>
            {% if counter.append(counter.pop() + 1) %}{% endif %}
            {% if counter == [3] %} 
                </div> <!-- End row -->
            {% endif %}
        {% endif %}
    {% endfor %}
    {% if counter != [0] %}
        </div> <!-- No more classes, but finish row -->
    {% endif %}
    </div>

</div>

<script>
/* For code refactoring of creating these class boxes */
</script>

{% endblock %}
{% block footer %}
{{ super() }}
{% endblock %}
