<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Hermes</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>


  </head>

  <body>
    <div id="ytplayer"></div>
    <div id="questions">
      <input id='question' placeholder='Enter your question here'></input>
      <button type=submit onclick="sendQuestion()">Submit Question</input>
    </div>
    <div>
        <table id='questions_table'>
          {% for question in db['Questions'].find({'lecture_id': lecture}).sort([('seconds', 1)]) %}
            <tr>
              <td>{{question['name']}}</td>
              <td>{{question['timestamp']}}</td>
              <td>{{question['text']}}</td>
            </tr>
          {% endfor %}
        </table>
    </div>



<script>
  // Load the IFrame Player API code asynchronously.

  // https://www.youtube.com/watch?v=JPb1k6JdGvg
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/player_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  // Replace the 'ytplayer' element with an <iframe> and
  // YouTube player after the API code downloads.
  var player;
  function onYouTubePlayerAPIReady() {
    player = new YT.Player('ytplayer', {
      height: window.innerHeight / 2,
      width: window.innerWidth / 2,
      videoId: '{{ id }}',
      events: {
        'onStateChange': recordData
      }
    });
  }

  function recordData(event) {
      // Send info for student tracking purposes
  }

  function sendQuestion() {
      var seconds = player.getCurrentTime();
      var question = document.getElementById('question').value;



      var data = {
         seconds,
         text: question,
         name: "{{ user['name'] }}",
         ok_id: "{{ user['ok_id'] }}",
         lecture: "{{ lecture }}",
         cls: "{{ cls }}"
      }

      console.log(`${JSON.stringify(data)}`)

      $.ajax({
        type: "POST",
        url: "{{ url_for('write_question')}}",
        data,
        success: function (data) {
            $("#questions_table").find("tr").remove();
            $('#questions').load('');
        }
      });


  }

</script>



  </body>


</html>
