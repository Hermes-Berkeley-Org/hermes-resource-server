{% extends 'header.html' %}
{% block title %}Hermes | {{info["Name"]}}{% endblock %}
{% block head %}{{ super() }}{% endblock %}
{% block content %}
<div class="wrapper text-primary">
  <div class="row classtable">
    <div class="col-md-6">
      <h4>{{info['display_name']}}</h4>
      <table class ="lecture_table" id = "lec_table">
        <tr>
          <th> </th>
          <th>Lecture</th>
          <th>Date Posted</th>
          <th></th>
        </tr>
        {% for lec in lectures %}
          <tr id = lecture-{{lec['_id']}} class="lec-row">
            {% if lec['is_playlist'] %}
              <td>
                <a id="show-videos-{{lec['_id']}}" data-toggle="collapse" onclick="toggleVideos('toggle-icon-{{lec['_id']}}')" data-target="#playlists-{{lec['_id']}}">
                <span class="fa fa-chevron-down qa-entry" aria-hidden="true" id="toggle-icon-{{lec['_id']}}"></span></a></td>
              <td><a href={{ url_for('lecture', cls=lec['cls'], lecture_number=lec['lecture_number'], playlist_number="0")}}>{{ lec['name'] }}</a></td>
            {% else %}
            <td></td>
              <td><a href={{ url_for('lecture', cls=lec['cls'], lecture_number=lec['lecture_number'])}}>{{ lec['name'] }}</a></td>
            {% endif %}
            <td>{{lec['date']}}</td>
            {% if role == consts.INSTRUCTOR %}
              <td><i class="fa fa-close" style="color:red" type=submit onclick="deleteLecture('{{lec['_id']}}')"></i></td>
            {% endif %}
          </tr>
          {% if lec['is_playlist'] %}
          <tr id="playlists-{{lec['_id']}}" class = "collapse">
            <td> </td>
            <td>
              {% for video in range(lec['videos']|length) %}
                <a href={{ url_for('lecture', cls=lec['cls'], lecture_number=lec['lecture_number'], playlist_number= video) }}> Lecture Video {{ video + 1 }}</a>
                {% if not loop.last %}
                  <br>
                {% endif %}
              {% endfor %}
            </td>
            <td> </td>
            <td> </td>
          </tr>
        {% endif %}
        {% endfor %}
      </table>
    </div>
    <div class="col-md-6">
        {% if role == consts.INSTRUCTOR %}
          <form action="" method="post">
              <h4>Create a Lecture</h4>
              {{ form.csrf }}
              <p>Lecture Title {{ form.title }}</p>
              <p>Lecture Date {{ form.date }}</p>
              <p>Youtube Lecture/Playlist Link {{ form.link }}</p>
              <p id="submit">{{ form.submit() }}</p>
          </form>
        {% endif %}
        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <ul class=flashes>
            {% for message in messages %}
              <li>{{ message }}</li>
            {% endfor %}
            </ul>
          {% endif %}
        {% endwith %}
    </div>

</div>

<script>
    function deleteLecture(lectureid){
      var data ={
        lectureid,
        user_id: '{{ user["_id"]|string }}',
        class_ok_id: '{{ info["ok_id"] }}'
      };

      console.log(`${JSON.stringify(data)}`)
      $.ajax({
        type: "POST",
        url: "{{ url_for('delete_lecture') }}",
        data,
        success: function (data) {
          $('#lec_table').load(window.location.href + ' #lec_table');
        }
      });
    }

    function dropDown() {
    document.getElementById("myDropdown").classList.toggle("show");
  }

  // Close the dropdown menu if the user clicks outside of it
  window.onclick = function(event) {
    if (!event.target.matches('.dropbtn')) {

      var dropdowns = document.getElementsByClassName("dropdown-content");
      var i;
      for (i = 0; i < dropdowns.length; i++) {
        var openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
          openDropdown.classList.remove('show');
        }
      }
    }
  }

  function toggleVideos(buttonId) {
    elem = document.getElementById(buttonId);
    if (elem) {
      if (elem.classList.contains('fa-chevron-down')) {
        elem.classList.remove('fa-chevron-down');
        elem.classList.add('fa-chevron-up');
      } else {
        elem.classList.remove('fa-chevron-up');
        elem.classList.add('fa-chevron-down');
      }
    }
  }
</script>
{% endblock %}
{% block footer %}
{{ super() }}
{% endblock %}
